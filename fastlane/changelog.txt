Stability improvements and bug fixes.

